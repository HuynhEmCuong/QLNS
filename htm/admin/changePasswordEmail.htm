<?php
	@session_start();
	require_once('../../lib/'.'BaseDir.inc.htm');
	require_once (EIU_LIB.'View.class.htm');
	require_once('../../lib/'.'DBCommon.class.htm');
	require_once (EIU_CLASS.'LoginClass.htm');
	require_once (EIU_CLASS.'PermissionClass.htm');

	//print_r($_POST);
	if(checkSession('changePasswordEmail.htm')==true){
		$data1 = setSession();
	}
	
	$screen = basename($_SERVER["REQUEST_URI"]).PHP_EOL;
	$data1['screen'] = RTRIM($screen);
	
	$data1 = checkPermission($data1);
	$data1['emailAdd'] = $_POST['email'];
	$data1['departmentName'] = $_POST['departmentName'];
	$data1['departmentID'] = $_POST['departmentID'];
	//print_r($data1);
	//Process SubPermission
	if(checkIsAdmin($data1['userId'])==1){
		$data1['permission'] = 4;
		$data1['add'] = 4;
		$data1['update'] = 4;
		$data1['reset'] = 4;
		$data1['upload'] = 4;
		$data1['account'] = 4;
		$data1['email'] = 4;
		$data1['list'] = 4;
	}else if(is_array($data1['subPermission'])){
		$data1['add'] = $data1['subPermission'][2];
		$data1['update'] = $data1['subPermission'][3];
		$data1['reset'] = $data1['subPermission'][4];
		$data1['upload'] = $data1['subPermission'][6];
		$data1['account'] = $data1['subPermission'][8];
		$data1['email'] = $data1['subPermission'][9];
		$data1['list'] = $data1['subPermission'][1];
	}
		
	//permission 1:access, 2:view, 3:update, 4:delete
	if($data1['permission']>0){
		$view = new View();
		$view->showTmpl("changePasswordEmail.tmpl","n",$data1);
	}else{
		echo "Can not access to this page";
	}
	
	/*if(isset($_GET['empId']) && !empty($_GET['empId'])){
		echo '<script type="text/javascript">';
		echo "var empId = ".$_GET['empId'];
		echo '</script>';
	}else{
		echo '<script type="text/javascript">';
		echo "var empId = ''";
		echo '</script>';
	}*/
?>
