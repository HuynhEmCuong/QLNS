<html>jj
<head>
	<title>CHANGE PASSWORD DETAIL</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script type="text/javascript" src="../../htm/js/indecator.js"></script>
	<script type="text/javascript" src="../../htm/js/base.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery.crypt.js"></script>
	
	<style type="text/css">
		body{
			font-size: 12px;
		}
		
		#outter{
			width:900px;
			margin: 0 auto;
			margin-top:20px;
		}
		
		#header{
			width:450px;	
			padding-top:15px;
		}
		
		#content{
			display:table;
			width:410px;
		}
		
		#footer{
			width:416px;			
			text-align:center;
			margin-top:15px;
			margin-left:138px;
		}
		
		.row{			
			width:100%;	
			float:left;
			margin-top:5px;
		}
		
		.telCont, .position, .mobileCont,.contractAmount, .contractUnit, .address, .prpoNo, .prpoNoDate, .costCode, .mcboq, .description, .supplier, .issued, .contract,.shortNameDt,.fullNameDt{
			display: table-cell;
			vertical-align:middle;			
			padding-left:4px;			
		}

		.prpoNo{
			font-weight:bold;
			text-align:right;
			width:75px;
			background-color:#DCE6F2;
			border: 1px solid #8EB4E3;
			padding-right:5px;
			height:20px;
		}
		
		.prpoNoDate{
			width:320px;
			text-align:left;
		}
		.title{
			height:34px;
		}
		
		.inputHeight{
			height:25px;
		}
		
		.txt-center{
			text-align:center;
		}
		
		
		#titleSResul{
			width:100%; 
			display:table;			
			background-color: #17375E;
			color: #FFFFFF;
			font-weight:bold;
		}
		
			
		.txt-center{
			text-align:center;
		}
		
		#indecator{
			margin-left: 298px;
		}
		/*header*/
	.bg-titlemp{
		color:#c00000;
	}
	.mp-title{
		font-size: 16pt;
		font-weight: bold;
		margin: 5px;
	}
	.bg-line{
		color:#4a7ebb;
		margin-bottom: 10px;
	}
	.bo-bottom{
		border-bottom: 1px solid;
	}
	a#logout{
		float: right;
		font-size: 10px;
		margin-top: 15px;
	}
	.login{
		color: blue;
		float: right;
		font-size: 15px;
		font-style: italic;
		font-weight: normal;
		margin-right: 10px;
		margin-top: 13px;
	}
	.text-center{
		text-align:center;
	}
	
	.text-left{
		text-align:left;
	}
	
	.color-title{
		color:#17375e;
	}
	
	a{
		color:#000000;
	}
	
	a:hover{
		color:blue;
	}
	
	a.choose{
		color: blue;
		font-weight: bold;
		text-decoration: underline;
	}
	
	#saveInfo{
		width:100%;
		float:left;
		margin: 0 auto;
		margin-top:25px;
		
	}
		
	img.display-none{
		display:none;
	}
	</style>
	
	<script type="text/javascript">
		var empId = '{val userId}';
		var code = empId.substr(0,2);
		function process()
		{
			var dat = "";
			//alert(empId);
			if(empId != ''){
				//--Hard code TTNN
				//var code = empId.substr(0,2);
				//alert(code);
				/*if(code=='08'){
					removeClass(document.getElementById('email'),'display-none');
					addClass(document.getElementById('report'),'display-none');
				}*/
				//--End Hard code TTNN
				
				loadAjax();
			}else{
				enableFields();
				document.getElementById("row-id").setAttribute('style','display:none');
				document.getElementById("editBut").setAttribute('style','display:none');
				document.getElementById("deleteBut").setAttribute('style','display:none');
			}
		}
		
		function clickCancel(){
			//if(code=='08'){
				//location.href="importEnglishClass.htm";
			//}else{
				location.href="listStaff.htm";
			//}
		}

		//hàm dùng de set du lieu cho các input
		function setValue(dat)
		{
			disableFields();
			document.getElementById("id").value = dat.id;
			document.getElementById("name").value = dat.name;
		//	document.getElementById("position").value = dat.position;
		//	document.getElementById("department").value = dat.department;
			
			//Disable save button len
			document.getElementById("saveBut").disabled = true;
		}
		
		//Hàm dùng d? enable các inut field 
		function enableFields(){
			//document.getElementById("id").disabled = false;
			document.getElementById("currPass").disabled = false;
			document.getElementById("newPass").disabled = false;
			document.getElementById("reNewPass").disabled = false;
			
			
			//Enable save button len
			document.getElementById("saveBut").disabled = false;
		}
		
		//Hàm dùng d? các input field invisible
		function disableFields(){
			document.getElementById("currPass").disabled = true;
			document.getElementById("newPass").disabled = true;
			document.getElementById("reNewPass").disabled = true;
		}
		
		function ajaxFunction(){
			var ajaxRequest;

			try{
				// Opera 8.0+, Firefox, Safari
				ajaxRequest = new XMLHttpRequest();
			} catch (e){
				// Internet Explorer Browsers
				try{
					ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
				} catch (e) {
					try{
						ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
					} catch (e){
						//browsers all not support, rare case
						alert("Your browser broke!");
						return false;
					}
				}

			}
			return ajaxRequest;
		}
		
		function loadAjax() {
			var url = "ajaxLoadEmpDetail.htm";
			queryString = "";
			queryString += "empId="+empId;
			
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
					//alert(htmlRequest.responseText);
					dat = htmlRequest.responseText;
					var dat = eval('(' + dat + ')');
					setValue(dat);
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				
		//	htmlRequest.setRequestHeader("Content-length", queryString.length);
		//	htmlRequest.setRequestHeader("Connection", "close");
			htmlRequest.send(queryString);
			//htmlRequest.send(null);
			
		}
		
		var isUser=true;
		function checkPassword(obj){
			var queryString = "";
			queryString += "empId="+empId+"&pass="+obj.value;
			
			var url = "ajaxCheckPass.htm";
			
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			} 
			
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
					if(trim(htmlRequest.responseText)!='OK'){
						isUser=false;
						alert("Wrong password!");
						document.getElementById('currPass').value = '';
						obj.focus();
					}else{
						isUser=true;
					}
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				
		//	htmlRequest.setRequestHeader("Content-length", queryString.length);
		//	htmlRequest.setRequestHeader("Connection", "close");
			htmlRequest.send(queryString);
		}
		
		function changePass(){
			var currPass = document.getElementById('currPass').value;
			var newPass = document.getElementById('newPass').value;
			var reNewPass = document.getElementById('reNewPass').value;
			
			if(newPass!=reNewPass){
				alert('The passwords you typed do not match. Please retype the new password in both boxes.');
			}else{
				if(isUser==true){
					var queryString = "";
					queryString += "empId="+empId+"&pass="+currPass+"&newPass="+newPass;
				//	alert(queryString);
					var url = "ajaxUpdatePass.htm";
					
					htmlRequest = ajaxFunction();
					if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
						alert ("Browser does not support HTTP Request");
						return;
					} 
					
					htmlRequest.onreadystatechange = function(){
						if(htmlRequest.readyState == 4){
						//	alert(htmlRequest.responseText);exit();
							if(trim(htmlRequest.responseText)=='OK'){
								alert("Password changed.");
								window.close();
								//alert(code);
								//if(code=='08'){
									//location.href="importEnglishClass.htm";
								//}else{
									//location.href="listStaff.htm";
								//}
								//--End Hard code TTNN
								//location.href="listStaff.htm";
							}else{
								alert("Not change password.");
							}
						}
					}
					
					htmlRequest.open("POST", url,true);
					htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
						
				//	htmlRequest.setRequestHeader("Content-length", queryString.length);
				//	htmlRequest.setRequestHeader("Connection", "close");
					htmlRequest.send(queryString);
				}
			}
		}
		
		function back(){
			window.close();
		}
		
		$(document).ready(function(){
			$("#currPass").change(function(){
				if( $('input#currPass').val() != '' ) {
					pwEncrypt = $().crypt( {
						method: 'md5',
						source: $('input#currPass').val()
					});
					$('input#currPass').val(pwEncrypt);   
					//return;
				}
				checkPassword(document.getElementById('currPass'));
			});
			
			$("#newPass").change(function(){
				if( $('input#newPass').val() != '' ) {
					pwEncrypt = $().crypt( {
						method: 'md5',
						source: $('input#newPass').val()
					});
					$('input#newPass').val(pwEncrypt);   
					//return;
				}
			});	
			$("#reNewPass").change(function(){
				if( $('input#reNewPass').val() != '' ) {
					pwEncrypt = $().crypt( {
						method: 'md5',
						source: $('input#reNewPass').val()
					});
					$('input#reNewPass').val(pwEncrypt);   
					//return;
				}
			});
		});
		
	/*	function back(){
		//	location.href = "employeeList.htm";
		}*/
	</script>
</head>

<body onload="getCookiesUser();process();">
	<!--use for cookie-->
	<input id="UserID" hidden value={val userId} />
	<input id="StartTime" hidden value={val userLoginTime} />

<div id="outter">
		<div><a href="logout.htm" id="logout">Logout</a><div class="login"><b>{val userName}</b> {val userLoginTime}</div>
		<div style="float: left;margin-right: 20px;"><img style="width:100px;" src="../../img/logo.PNG"/></div>
		<div class="bo-bottom bg-line" style="float: right;width: 780px;">
			<div class="bg-titlemp mp-title">TRƯỜNG ĐẠI HỌC QUỐC TẾ MIỀN ĐÔNG<br><span style="font-size: 13pt;color: #1C1757;padding-left: 46px;">EASTERN INTERNATIONAL UNIVERSITY</span></div>
			<div><img id="email" class="display-none" src="../../img/icon-send-email.jpg" title="Auto Send Email" width=50px onClick="window.location.href='importEnglishClass.htm'" style="float: right;margin-top: -45px;width:65px" /><img id="report" src="../../img/report-icon.png" title="Report" onClick="window.location.href='listStaff.htm'" style="cursor:pointer;float: right;margin-top:-45px" /></div>
		</div>
		<div class="text-center color-title" style="clear:both;"><h1>CHANGE PASSWORD DETAIL</h1></div>
		
		<div id="indecator" style="display:none">
			<form name="clkform" action="javascript:void(0);">
				<input name="clk" size="25" style="color: #C00000;background-color:transparent;border:none; font-size:10px; font-weight:bold" type="text" value="Loading ----"/>
			</form>
		</div>
		<div id="content" style="margin: 0 auto;">
				<div class="row" id="row-id">
					<div class="prpoNo ">ID</div>
					<div class="prpoNoDate"><input id="id" disabled class="inputHeight" type="text" size="30"></div>
										
				</div>
				<div class="row">
					<div class="prpoNo ">Name</div>
					<div class="prpoNoDate"><input id="name" disabled class="inputHeight" type="text" size="30" required placeholder="Enter your text here" autofocus data-validate="{required:true,digits:true}"></div>
										
				</div>
				<!-- <div class="row">
					<div class="prpoNo ">Position</div>
					<div class="prpoNoDate"><input id="position" disabled class="inputHeight" type="text" size="30"></div>							
										
				</div>
				<div class="row">
					<div class="prpoNo ">Department</div>
					<div class="prpoNoDate"><input id="department" disabled class="inputHeight" type="text" size="30"></div>
				</div> -->
				<div class="row">
					<div class="prpoNo ">Password</div>
					<!-- <div class="prpoNoDate"><input id="department" disabled class="inputHeight" type="text" size="30"></div> -->
					<div class="prpoNoDate"><input class="inputHeight" id="currPass" name="account" type="password" size="30" required placeholder="Current password" autofocus></div>
				</div>
				<div class="row">
					<div class="prpoNo ">New Password</div>
					<div class="prpoNoDate"><input class="inputHeight" id="newPass" name="account" type="password" size="30" required placeholder="New password" data-validate="{required:true,digits:true}"></div>
				</div>
				<div class="row">
					<div class="prpoNo ">Confirm new password</div>
					<div class="prpoNoDate"><input class="inputHeight" id="reNewPass" name="account" type="password" size="30" required placeholder="Confirm new password" data-validate="{required:true,digits:true}"></div>
				</div>
		</div>
		<div id="footer">
			<!-- <input id="deleteBut" value="Delete" type="button" onclick="confirm_entry('employee');"/> -->
			<button id="cancelBut" style="float:right" onClick="clickCancel();">Cancel</button>
			<input id="saveBut" type="button" value="Save" onclick="changePass();" style="float:right"/>
			<button id="editBut" style="float:right" onclick="enableFields();">Edit</button>
		</div>
		<!-- Ch?a thông tin c?a save info -->
		<!-- <div id="saveInfo"></div> -->
		
</div>
<!--<body onload="loadAjax();">
	<input type="button" value="Submit" onclick="updateAjax();"/>
</body>-->
</html>