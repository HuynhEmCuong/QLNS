<html>
<head>
	<title>SEND EMAIL SCREEN</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link type="text/css" href="../../tmpl/css/popup.css" rel="stylesheet" />
	<script type="text/javascript" src="../../htm/js/indecator.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery-ui-1.8.9.custom.min.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery.crypt.js"></script>
	<script type="text/javascript" src="../../htm/js/base.js"></script>
	
	<style type="text/css">
		body{
			font-size: 12px;
		}
		
		#outter{
			width:900px;
			margin: 0 auto;
			margin-top:20px;
		}
		
		#header{
			width:450px;	
			padding-top:15px;
		}
		
		#content{
			/*width: 300px;
			background-color: #DCE6F2;
			border: 1px solid #8EB4E3;
			padding: 25px;*/
		}
		
		#footer{
			text-align:center;
			margin-top:300px;
			color: #827EB1;
		}
		
		.row{			
			width:100%;	
			float:left;
			margin-top:5px;
			margin-left:150px;
		}
		.prpoNo,.prpoNoDate{
			display: table-cell;
			vertical-align:middle;			
			padding-left:4px;			
		}
		.prpoNo{
			font-weight:bold;
			text-align:right;
			width:80px;
			background-color:#DCE6F2;
			border: 1px solid #8EB4E3;
			padding-right:5px;
			height:20px;
		}
		
		.prpoNoDate{
			width:500px;
			text-align:left;
		}
		.title{
			height:34px;
		}
		
		.inputHeight{
			height:25px;
		}
		
		.txt-center{
			text-align:center;
		}	
			
		.txt-center{
			text-align:center;
		}
		
		#indecator{
			margin-left: 298px;
		}
		/*header*/
	.bg-titlemp{
		color:#c00000;
	}
	.mp-title{
		font-size: 16pt;
		font-weight: bold;
		margin: 5px;
		float: left;
	}
	.bg-line{
		color:#4a7ebb;
		margin-bottom: 10px;
	}
	.bo-bottom{
		border-bottom: 1px solid;
	}
	a#logout{
		float: right;
		font-size: 10px;
		margin-top: 15px;
	}
	.login{
		color: blue;
		float: right;
		font-size: 15px;
		font-style: italic;
		font-weight: normal;
		margin-right: 10px;
		margin-top: 13px;
	}
	
	
	
	.text-center{
		text-align:center;
	}
	
	.color-title{
		color:#17375e;
	}
	
	.text-left{
		text-align:left;
	}	
	a{
		color:#000000;
	}
	
	a:hover{
		color:blue;
	}
	
	a.choose{
		color: blue;
		font-weight: bold;
		text-decoration: underline;
	}
	
	.display{
		display:block;
	}
	.display-none{
		display:none;
	}		
	.inputHeight{
		height:25px;
	}
	#emailList{
		position: absolute;
		visibility: hidden;
		width: 300px;
		//height: 100%;		
		background-color: #FFFFFF;
		border-top: 1px solid #8EB4E3;
		border-left: 1px solid #8EB4E3;
		border-right: 1px solid #8EB4E3;
		border-bottom: 1px solid #8EB4E3;
		padding: 10px 10px 4px 10px;	
	}
	.ENMeanPopup{
		width:150px;
		display:table-cell;
		//margin-left:5px;
		//vertical-align:middle;
	}
	.CostCodePopup
	{
		width:150px;	
		display:table-cell;
		margin-left:5px;
		//vertical-align:middle;
	}
	
	#titleSResul{
		width:700px; 
		display:table;			
		background-color: #17375E;
		color: #FFFFFF;
		font-weight:bold;		
	}
	.row_list{				
		margin-left:100px;
	}
	.No,.No1,.Code,.Code1,.Name,.Name1{
		display: table-cell;
		vertical-align:middle;			
	}
	.No{
		width:26px;
		height:32px;
		//border-bottom: 1px solid #8EB4E3;
	}
	.No1{
		width:24px;
		height:32px;
		border-left: 1px solid #8EB4E3;	
		border-bottom: 1px solid #8EB4E3;
	}
	.Code{
		width:300px;
		height:32px;
		//border-bottom: 1px solid #8EB4E3;
	}
	.Code1{
		width:330px;
		height:32px;
		border-left: 1px solid #8EB4E3;
		//text-align:center;
		//border-top: 1px solid #8EB4E3;
		border-bottom: 1px solid #8EB4E3;
		padding-left:5px;
	}
	.Name{
		width:300px;
		height:32px;
		//border-bottom: 1px solid #8EB4E3;
	}
	.Name1{
		width:331px;
		height:32px;
		border-left: 1px solid #8EB4E3;
		border-right: 1px solid #8EB4E3;
		padding-left:5px;
		//border-top: 1px solid #8EB4E3;
		border-bottom: 1px solid #8EB4E3;
	}
	</style>
	
	<script type="text/javascript">
		var signClicked = "";	
		function addPer(Obj)
		{
			i=i+1;
			parentDiv = Obj.parentNode.parentNode;
			nextDiv = parentDiv.nextSibling;

			while (nextDiv.nodeType!=1)
			{
				nextDiv = nextDiv.nextSibling;
			}
						
			newDiv = parentDiv.cloneNode(true);			
			el = document.getElementById("content");
			el.insertBefore(newDiv,nextDiv);
			newDiv.setAttribute('id','row'+i);
			
		}
		function revPer(Obj)
		{
			input_box=confirm("Bạn có chắc chắn muốn xóa dòng này?");
			if (input_box==true)
			{ 
				parentDiv = Obj.parentNode.parentNode;
				el = document.getElementById("content");				
				el.removeChild(parentDiv);
			}
					
		}
		function ajaxloadEmail()
		{
			var url = "ajaxLoadSchoolEmail.htm";
			var email=document.getElementById("emailID").value;
			//alert(email);
			var queryString = '&email='+email;
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
					//alert(htmlRequest.responseText);
					dat = htmlRequest.responseText;
					//alert(dat);
					dat = eval('(' + dat + ')');
					loadEmail(dat);					
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			htmlRequest.send(queryString);
		}
		function loadEmail(dat)
		{
			var contentPopup=document.getElementById("contentEmail");
			contentPopup.innerHTML="";
			if(dat!="")
			{
				var count=dat.Result.length;
				//alert(count);
				for(var j=0;j<count;j++)
				{
					var rowPopup = document.createElement('div');
					rowPopup.setAttribute('class','rowPopup');
					rowPopup.setAttribute('id','rPopup');
					
						var name = document.createElement("div");
						name.setAttribute('class','CostCodePopup');
						name.setAttribute('id','NamePopup'+j);
						name.setAttribute('onclick','getEmail('+j+');');
						name.innerHTML = dat.Result[j].FullName;
					
						var email = document.createElement("div");
						email.setAttribute('class','ENMeanPopup');
						email.setAttribute('id','EmailPopup'+j);
						email.setAttribute('onclick','getEmail('+j+');');
						email.innerHTML = dat.Result[j].SchoolEmail;
						
						var staffID = document.createElement("div");						
						staffID.setAttribute('id','staffIDPopup'+j);
						staffID.setAttribute('hidden','true');
						staffID.innerHTML = dat.Result[j].StaffID;
						
					rowPopup.appendChild(name);
					rowPopup.appendChild(email);
					rowPopup.appendChild(staffID);
					contentPopup.appendChild(rowPopup);
				}
			}
			
		}
		function getEmail(j)
		{			
			//alert(j);
			//alert(i);			
			var email=document.getElementById('EmailPopup'+j).innerHTML;
			var name=document.getElementById('NamePopup'+j).innerHTML;
			var staffID=document.getElementById('staffIDPopup'+j).innerHTML;
			//alert(staffID);
			document.getElementById("emailID").value=email;
			document.getElementById("Name").innerHTML=name;
			document.getElementById("staffID").innerHTML=staffID;
			closePopup('emailList');	
			document.getElementById("saveBut").disabled = false;			
		}
		//Mo popup
		function openPopup(idClicked,idOpen)
		{
			//Gi? gi� tr? id c?a � ch? k� v?a du?c click v�o
			signClicked = idClicked;
			var layer = document.getElementById(idOpen);			
			bodyWidth = window.innerWidth;
			bodyHeight = window.innerHeight;
			//alert(idClicked);
			var but = document.getElementById(idClicked);
			//alert(but.offsetTop);
			if((bodyHeight - but.offsetTop)<50){
				layer.style.top = (but.offsetTop-200)+'px';
			}else{
				layer.style.top = (but.offsetTop+23)+'px';
			}
				
			//alert(bodyWidth-but.offsetLeft);
				
			if((bodyWidth-but.offsetLeft)<400)
			{
				layer.style.left = (but.offsetLeft-300)+'px';
			}else layer.style.left = (but.offsetLeft)+'px';
				
			//layer.style.visibility = (layer.style.visibility == 'visible') ? 'hidden' : 'visible';
			layer.style.visibility='visible';
			ajaxloadEmail();
			//delete(but);
			//Gi? gi� tr? id c?a � ch? k� v?a du?c click v�o			
		}
		function closePopup(id)
		{
			var layer = document.getElementById(id);
			layer.style.visibility = (layer.style.visibility == 'visible') ? 'hidden' : 'visible';			
		}
		function createRow()
		{
			i=i+1;
			var content=document.getElementById('content');
			var row = document.createElement('div');
			row.setAttribute('class','row');
			row.setAttribute('id','row'+i);
				var prpo = document.createElement('div');
				prpo.setAttribute('class','prpoNoDate');
				
					var input=document.createElement('input');
					input.setAttribute('id','emailID'+i);
					input.setAttribute('onclick','this.value=""');
					input.setAttribute('onchange','openPopup("emailID'+i+'","emailList");');
					input.setAttribute('class','inputHeight');
					input.setAttribute('type','text');
					input.setAttribute('placeholder','Email');
					input.setAttribute('size','30');
					
					var id=document.createElement('div');
					id.setAttribute('id','Name'+i);
					id.setAttribute('hidden','true');					
					
					var add=document.createElement('button');
					add.setAttribute('name','add_im');
					add.setAttribute('onclick','createRow();');
					add.innerHTML='Add';
					
					var del=document.createElement('button');
					del.setAttribute('name','del_im');
					del.setAttribute('onclick','revPer(this);');
					del.innerHTML='Delete row';
					
			row.appendChild(prpo);			
			prpo.appendChild(input);
			prpo.appendChild(id);
			prpo.appendChild(add);
			prpo.appendChild(del);
			content.appendChild(row);
			
		}
		function save()
		{
			//alert(i);
			var strJson = "";
			strJson = '{';
			strJson += '"emailList":[{';
						
			if(document.getElementById("emailID").value!="")
			{
				//strJson += '{';
				strJson += '"staffID":"' +document.getElementById("staffID").innerHTML + '",';
				strJson += '"name":"' +document.getElementById("Name").innerHTML + '",';	
				strJson += '"email":"' +document.getElementById("emailID").value + '",';		
				strJson += '"modified":"{val userName}"}';
				strJson += "}";
			}
			else
			{
				strJson += "}";		
			}
			//strJson += "}";					
			var str = new String(strJson);
			strJson = str.substr(0,str.length-1) + ']}';
			strJson = strJson.replace(/&/g, "%26");
			strJson = strJson.replace(/\+/g, "%2B");
			//alert(strJson);
			updateAjax(strJson);
		}
		function updateAjax(saveInfo) 
		{
			document.getElementById("saveBut").disabled = true;
			var content=document.getElementById("content_list");
			
			var url = "ajaxUpdateSend_email_to.htm";
			var queryString = "";
			queryString += "info="+saveInfo;
			//alert(queryString);
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.open("POST", url,true);
			htmlRequest.onreadystatechange = function()
			{
				if(htmlRequest.readyState == 4)
				{
					if(htmlRequest.responseText = 'OK')
					{
						//alert("Successful");
						alert(htmlRequest.responseText);
						content.innerHTML="";
						loadAjax();
						document.getElementById("emailID").value="";
						document.getElementById("Name").innerHTML="";
						//document.getElementById("saveBut").disabled = true;
					}
					else
					{
						alert("Not successful");
						return;
					}
					//document.getElementById("saveBut").disabled =true;
					//document.getElementById("addInfo").disabled =false;
					//document.getElementById("Edit").disabled =false;
				}
			}
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			htmlRequest.send(queryString);
		}
		function loadAjax()
		{
			var url = "ajaxLoadEmailSendToList.htm";
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			} 

			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
					//alert(htmlRequest.responseText);
					if(trim(htmlRequest.responseText)!='NG'){
						EMAIL = htmlRequest.responseText;
						//alert(htmlRequest.responseText);
						EMAIL = eval('(' + EMAIL + ')');						
						loadEmailList();
					}					
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				
		//	htmlRequest.setRequestHeader("Content-length", queryString.length);
			//htmlRequest.setRequestHeader("Connection", "close");
		//	htmlRequest.send(queryString);
			htmlRequest.send(null);
		}
		function loadEmailList()
		{
			//alert(EMAIL.Result.length);
			var content=document.getElementById("content_list");
			for (i=0;i<EMAIL.Result.length;i++) 
			{
				var row = document.createElement('div');
				row.setAttribute('id','r-'+i);
				if(i%2)
				{
					row.setAttribute('class','row_list even rowheight');
				}
				else
				{
					row.setAttribute('class','row_list rowheight');
				}
				var id=EMAIL.Result[i].ID;
				var divdel=document.createElement('div');
				divdel.setAttribute('class','No1 text-center');
						
				var del=document.createElement('input');
				del.setAttribute('id','delete'+i);
				del.setAttribute('type','image');
				del.setAttribute('src','../../img/icon-delete.png');
				del.setAttribute('name','img'+i);
				//del.setAttribute('class','del1');
				//del.setAttribute('onclick','storeClickedRow('+i+')');
				//del.setAttribute('onclick','storeClickedRow('+i+');confirm_entry("block");deleteAjax('+id+');');
				del.setAttribute('onclick','deleteAjax('+id+');');
				divdel.appendChild(del);
				row.appendChild(divdel);
				
				var ID=document.createElement('div');
				ID.setAttribute('id','ID'+i);
				ID.innerHTML=EMAIL.Result[i].ID;
				ID.setAttribute('hidden',true);
				row.appendChild(ID);
				
				var name=document.createElement('div');
				name.setAttribute('id','name'+i);
				name.innerHTML=EMAIL.Result[i].Name;	
				name.setAttribute('class','Code1 text-left');
				//name.setAttribute('onclick','storeClickedRow('+i+')');
				row.appendChild(name);
				
				var email=document.createElement('div');
				email.setAttribute('id','email'+i);
				email.innerHTML=EMAIL.Result[i].emailto;
				email.setAttribute('class','Name1');
				//email.setAttribute('onclick','storeClickedRow('+i+')');
				row.appendChild(email);
				
				content.appendChild(row);		
				
			}
			
		}
		function deleteAjax(id)
		{
			//alert(id);
			//document.getElementById("saveBut").disabled = true;
			var content=document.getElementById("content_list");
			
			var url = "ajaxUpdateSend_email_to.htm";
			var queryString = "";
			queryString += "isDeleted="+'1'+"&ID="+id;
			//alert(queryString);
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
					//alert(htmlRequest.responseText);
					
					if(htmlRequest.responseText != 'NG')
					{
						alert('Delete email successful!');
						content.innerHTML="";
						loadAjax();						
					}
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				
			//htmlRequest.setRequestHeader("Content-length", queryString.length);
			//htmlRequest.setRequestHeader("Connection", "close");
			htmlRequest.send(queryString);
		}
	</script>
</head>

<body scroll="no" style="overflow-y:hidden;" onload="getCookiesUser();loadAjax();" >
	<!--use for cookie-->
	<input id="UserID" hidden value={val userId} />
	<input id="StartTime" hidden value={val userLoginTime} />
	<input id="email" hidden value={val email} />
	<input id="userName" hidden value={val userName} />
	<!-- pop up-->
	<div id="emailList" >		
		<div style="height:151px; overflow-y:auto;">
			<div id="contentEmail"></div>
		</div>
		<div style="margin-top:4px;">
			<button style="float:right" onclick="closePopup('emailList')">Cancel</button>					
		</div>
	</div>
	<!-- content web-->
	<div id="outter">
		<div><a href="logout.htm" id="logout">Logout</a><div class="login"><b>{val userName}</b> {val userLoginTime}</div></div>
		<div style="float: left;margin-right: 20px;"><img src="../../img/logo.PNG"/></div>
		<div class="bo-bottom bg-line" style="float: right;width: 780px;">
			<div class="bg-titlemp mp-title">TRƯỜNG ĐẠI HỌC QUỐC TẾ MIỀN ĐÔNG<br><span style="font-size: 13pt;color: #1C1757;padding-left: 46px;">EASTERN INTERNATIONAL UNIVERSITY</span></div>
		</div>		
		<div id="content" style="margin: 10px auto;clear:both;width:650px;">
			<div class="color-title text-center "><h1>SEND EMAIL TO</h1></div>				
			<div class="row" id="row">				
				<div class="prpoNoDate">
					<input id="emailID" onclick="this.value='';" onkeyup="openPopup('emailID','emailList');" class="inputHeight" type="text"  placeholder="Email" size="30">
					<div id="Name" hidden></div>
					<div id="staffID" hidden></div>
					<input id="saveBut" type="button" disabled onclick="save();" value="Add"/>	
					<!--<button name="del_im" onclick="revPer(this)">Delete row</button>	-->			
				</div>
			</div>				
		</div>
		<div style="height:10px;"></div>
		<div id="titleSResul" style="margin-top:40px;margin-left:100px;">
				<div class="row_list txt-center">
					<div class="No"></div>
					<div class="Code">FullName</div>
					<div class="Name">Email To</div>
				</div>
		</div>
		<div id="content_list"></div>		
	</div>
</html>