<html>
<head>
	<title>LOGIN SCREEN</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script type="text/javascript" src="../../htm/js/indecator.js"></script>
	<script type="text/javascript" src="../../htm/js/base.js"></script>
	<link type="text/css" href="../../tmpl/css/redmond/jquery-ui-1.8.9.custom.css" rel="stylesheet" />
	<script type="text/javascript" src="../../htm/js/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery-ui-1.8.9.custom.min.js"></script>
	<script type="text/javascript" src="../../htm/js/jquery.crypt.js"></script>
	
	<style type="text/css">
		body{
			font-size: 12px;
		}
		
		#outter{
			width:900px;
			margin: 0 auto;
			margin-top:20px;
		}
		
		#header{
			width:450px;	
			padding-top:15px;
		}
		
		#content{
			width: 300px;
			background-color: #DCE6F2;
			border: 1px solid #8EB4E3;
		}
		
		#footer{
			width:416px;			
			text-align:center;
			margin-top:15px;
			margin-left:138px;
		}
		
		.row{			
			margin: 5px;
		}
		
		.prpoNo{
			font-weight: bold;
			text-align: left;
			width: 65px;
			padding-right: 5px;
			height: 20px;
			float: left;
			padding-top: 6px;
			color: #17375E;
		}
		
		.prpoNoDate{
			width:320px;
			text-align:left;
		}
		.title{
			height:34px;
		}
		
		.inputHeight{
			height:25px;
		}
		
		.txt-center{
			text-align:center;
		}
		
		
		#titleSResul{
			width:100%; 
			display:table;			
			background-color: #17375E;
			color: #FFFFFF;
			font-weight:bold;
		}
		
			
		.txt-center{
			text-align:center;
		}
		
		#indecator{
			margin-left: 298px;
		}
		/*header*/
	.bg-titlemp{
		color:#c00000;
	}
	.mp-title{
		font-size: 16pt;
		font-weight: bold;
		margin: 5px;
	}
	.bg-line{
		color:#4a7ebb;
		margin-bottom: 10px;
	}
	.bo-bottom{
		border-bottom: 1px solid;
	}
	a#logout{
		float: right;
		font-size: 10px;
		margin-top: 15px;
	}
	.login{
		color: blue;
		float: right;
		font-size: 15px;
		font-style: italic;
		font-weight: normal;
		margin-right: 10px;
		margin-top: 13px;
	}
	.text-center{
		text-align:center;
	}
	
	.text-left{
		text-align:left;
	}
	
	.color-title{
		color:#17375e;
	}
	
	a{
		color:#000000;
	}
	
	a:hover{
		color:blue;
	}
	
	a.choose{
		color: blue;
		font-weight: bold;
		text-decoration: underline;
	}
	
	.display{
		display:block;
	}
	.display-none{
		display:none;
	}
	
	.iconLogin {
		background: url("../../img/ajax-loader.gif") no-repeat scroll left center transparent;
		width: 33px;
		height: 31px;
		margin: auto;
	}
	
	#staffID{
		margin-top: -26px;
		margin-left: 72px;
		width: 197px;
		height: 26px;
	}
		
	</style>
	
	<script type="text/javascript">
		var empNameList='';
		var username="--Select User Name --";
		var empId='';
		var dat='';
		
		function changeOption(f){
			empId = f.username.options[f.username.selectedIndex].value;
			username = f.username.options[f.username.selectedIndex].innerHTML;
			document.getElementById('staffID').value = empId;
			f.username.options[f.username.selectedIndex].innerHTML = username;
			if(username!="--Select User Name --"){
				addClass(document.getElementById('t-username'),'display-none');
				removeClass(document.getElementById('t-username'),'display');
			}
		}
		
		function loadEmpList(){
			empNameList=dat.empList;
			
			var EmpNameObj = document.getElementById("username");
			EmpNameObj.innerHTML = "";
			
			var option = document.createElement('option');
			option.innerHTML = "--Select User Name --";
			EmpNameObj.appendChild(option);
			
			for(var i=0; i< empNameList.length; i++){
				var option = document.createElement('option');
				option.innerHTML = empNameList[i].EmpID+'-'+empNameList[i].EmpFullName;
				option.value =  empNameList[i].EmpID;
				EmpNameObj.appendChild(option);
			}
		}
		
		function checkEnter(e,obj){
			if (e.keyCode == 13){
				if(obj.id=='staffID'){
				
				}else{
					if( $('input#password').val() != '' ) {
						pwEncrypt = $().crypt( {
							method: 'md5',
							source: $('input#password').val()
						});
						$('input#password').val(pwEncrypt);
					}
					
				}
				ajaxLogin();
			}
		}
		
		
		function changeUser(obj){
			var url = "ajaxLoadStaffLogin.htm";
			queryString = "staffID="+obj.value;
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
				//	alert(htmlRequest.responseText);
					var dataSearch = htmlRequest.responseText;
					dataSearch = eval('(' + dataSearch + ')');
					if(dataSearch.length==0){
						alert("Wrong Staff ID!");
						obj.focus();
						//obj.value='';
					}else{
						username = dataSearch.empList.EmpFullName;
						empId = dataSearch.empList.EmpID;
					//	obj.value = empId+"-"+username;
					}
					delete(dataSearch);
				}
			}
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			htmlRequest.send(queryString);
		}
		
		
		function loadAjax() {
			var url = "ajaxLoadEmpLogin.htm";
			queryString = "";
						
			htmlRequest = ajaxFunction();
			if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
				alert ("Browser does not support HTTP Request");
				return;
			}
			htmlRequest.onreadystatechange = function(){
				if(htmlRequest.readyState == 4){
				//	alert(htmlRequest.responseText);
					dat = htmlRequest.responseText;
					dat = eval('(' + dat + ')');
					loadEmpList();
				}
			}
			
			htmlRequest.open("POST", url,true);
			htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				
		//	htmlRequest.setRequestHeader("Content-length", queryString.length);
		//	htmlRequest.setRequestHeader("Connection", "close");
		//	htmlRequest.send(queryString);
			htmlRequest.send(null);
			
		}
		
		function save(){
			if(document.getElementById("name").value!=''){
				saveInfo = "{";
				saveInfo += '"id":"'+document.getElementById("id").value+'",';
				saveInfo += '"name":"'+document.getElementById("name").value+'",';
				saveInfo += '"position":"'+document.getElementById("position").value+'",';
				saveInfo += '"department":"'+document.getElementById("department").value+'",';
				saveInfo += '"tel":"'+document.getElementById("tel").value+'",';
				saveInfo += '"mobile":"'+document.getElementById("mobile").value+'",';
				saveInfo += '"address":"'+document.getElementById("address").value+'",';
				saveInfo += '"tel2":"'+document.getElementById("tel2").value+'",';
				saveInfo += '"mobile2":"'+document.getElementById("mobile2").value+'",';
				saveInfo += '"address2":"'+document.getElementById("address2").value+'",';
				saveInfo += '"email":"'+document.getElementById("email").value+'",';
				saveInfo += '"email2":"'+document.getElementById("email2").value+'"';
				saveInfo += "}";
				
				saveInfo = saveInfo.replace(/&/g, "%26");
				saveInfo = saveInfo.replace(/\+/g, "%2B");
				
				updateAjax(saveInfo);
			}else{
				alert('Employee name can not be null.');
			}
			
		}
		
		function ajaxLogin(){
		//	alert(empId);
			var passwordObj = document.getElementById('password');
			if(username == "--Select User Name --" && document.getElementById('staffID').value ==''){
				removeClass(document.getElementById('t-username'),'display-none');
				addClass(document.getElementById('t-username'),'display');
			}else{
				if(passwordObj.value==''){
					removeClass(document.getElementById('t-password'),'display-none');
					addClass(document.getElementById('t-password'),'display');
				}else{
					removeClass(document.getElementById('iconLogin'),'display-none');
					var queryString = "";
					queryString += "empId="+empId+"&pass="+passwordObj.value+"&islogin=1";
					var url = "ajaxCheckPass.htm";
					
					htmlRequest = ajaxFunction();
					if (htmlRequest==null){ // If it cannot create a new Xmlhttp object.
						alert ("Browser does not support HTTP Request");
						return;
					} 
					
					htmlRequest.onreadystatechange = function(){
						if(htmlRequest.readyState == 4){
						//	exit();
						//	alert(htmlRequest.responseText);
							if(trim(htmlRequest.responseText)=='NG'){
								removeClass(document.getElementById('t-password'),'display-none');
								addClass(document.getElementById('t-password'),'display');
								passwordObj.focus();
							}else if(trim(htmlRequest.responseText)=='OK'){
								removeClass(document.getElementById('t-password'),'display');
								addClass(document.getElementById('t-password'),'display-none');
								addClass(document.getElementById('iconLogin'),'display-none');
								alert("Login successful!");
								setCookiesUser(empId);
								/*Hard code for TTNN*/
								var code = empId.substr(0,2);
								//alert(code);
								//if(code=='08'){
									//location.href = 'importEnglishClass.htm';
								//}else{
									location.href='listStaff.htm';
								//}
							}else{
								if(getCookie('isLogin')!=1){
									setCookiesUser(empId);
								}
								addClass(document.getElementById('iconLogin'),'display-none');
								location.href=trim(htmlRequest.responseText);
							}
							addClass(document.getElementById('iconLogin'),'display-none');
						}
					}
					
					htmlRequest.open("POST", url,true);
					htmlRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
						
				//	htmlRequest.setRequestHeader("Content-length", queryString.length);
				//	htmlRequest.setRequestHeader("Connection", "close");
					htmlRequest.send(queryString);
				}
			}
		}
		
		$(document).ready(function(){
			$("#password").change(function(){
				if( $('input#password').val() != '' ) {
					pwEncrypt = $().crypt( {
						method: 'md5',
						source: $('input#password').val()
					});
					$('input#password').val(pwEncrypt);
					return;
				}
			});
		});
	</script>
</head>

<body onload="loadAjax();">
<div id="outter">
		<div class="bo-bottom bg-line">
			<div class="bg-titlemp mp-title">LOGIN SCREEN</div>
		</div>
		<!-- <div id="indecator" style="display:none">
			<form name="clkform" action="javascript:void(0);">
				<input name="clk" size="25" style="color: #C00000;background-color:transparent;border:none; font-size:10px; font-weight:bold" type="text" value="Loading ----"/>
			</form>
		</div> -->
		<div id="iconLogin" class="iconLogin display-none"></div>
		<div id="content" style="margin: 10px auto;">
			<div class="text-center color-title"><h1>LOGIN</h1></div>
			<div class="row">
				<div id="t-username" class="display-none" style="color:red;margin-left: 72px;">Please choose username!</div>
				<div class="prpoNo ">UserName</div>
				<div class="prpoNoDate">
					<form action="no_value" style="padding:0;margin:0">
						<select name="username" id="username" style="width: 215px;margin-left: 2px;height: 26px;" onchange="changeOption(this.form)"></select>
					</form>
					<input id="staffID" onkeydown="return checkEnter(event,this)" onChange="changeUser(this)" />
				</div>
			</div>
			<div class="row">
				<div id="t-password" class="display-none" style="color:red;margin-left: 72px;">Invalid password!</div>
				<div class="prpoNo ">Password</div>
				<div class="prpoNoDate"><input onkeydown="return checkEnter(event,this)" id="password" type="password" class="inputHeight" type="text" size="30" placeholder="Enter your text here"></div>							
			</div>
			<input id="userid" hidden />
			<button id="submit" style="margin-bottom: 10px;margin-left: 77px;" onclick="ajaxLogin();">Submit</button>
		</div>
	
		<!-- Ch?a thông tin c?a save info -->
		<div id="saveInfo"></div>
		
</div>
<!--<body onload="loadAjax();">
	<input type="button" value="Submit" onclick="updateAjax();"/>
</body>-->
</html>